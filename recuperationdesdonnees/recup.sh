#!/bin/bash

# Définir le chemin complet du fichier de sortie
output="/usr/share/recuperationdesdonnees/data/stations.json"

# Vérifier si le fichier existe déjà
if [ ! -f "$output" ]; then
    # Créer un fichier vide si nécessaire
    touch "$output"
fi

urls=("https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=100&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=200&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=300&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=400&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=500&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=600&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=700&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=800&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=900&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=1000&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=1100&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=1200&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=1300&timezone=Europe%2FParis" "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records?select=stationcode%2C%20name%2C%20is_installed%2C%20capacity%2C%20numdocksavailable%2C%20numbikesavailable%2C%20mechanical%2C%20ebike%2C%20is_renting%2C%20is_returning%2C%20duedate%2C%20coordonnees_geo%2C%20nom_arrondissement_communes&order_by=nom_arrondissement_communes&limit=100&offset=1400&timezone=Europe%2FParis")

# Boucle infinie pour exécuter le script toutes les 5 minutes
while true; do

    # Boucle sur chaque URL
    for url in "${urls[@]}"
    do
        # Télécharger le contenu JSON de l'API
        json=$(curl -s "$url")

        # Utiliser jq pour itérer sur chaque station dans la liste 'results' et les écrire dans le fichier de sortie
        # En ajoutant chaque nouvelle entrée à la fin du fichier, chaque objet sur une nouvelle ligne
        echo "$json" | jq -c '.results[]' >> "$output"
    done

    # Afficher le chemin du fichier de sortie
    echo "Les données sont écrites dans $output"

    # Attendre 5 minutes avant de recommencer
    sleep 900

done